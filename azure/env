#!/bin/bash
# prepare environment to use azcopy
#
# this script:
#   1. loads in your azure tokens
#   2. gets the urls for the azure buckets
#   3. downloads azcopy (if DNE locally)
#
# call in your local scope:
#   > . azure/env

# exit on error
set -e

# check for azure token
if [ ! -f "secrets/azure-public" ] || [ ! -f "secrets/azure-private" ]; then
    echo "ERROR: To access Azure, you must the following SAS tokens:"
    echo "  1) secrets/azure-public (for accessing the litmon bucket)"
    echo "  1) secrets/azure-private (for accessing the litmon-private bucket)"
    exit 1
fi

# load in azure tokens
AZURE_PUBLIC_KEY=$(cat secrets/azure-public)
AZURE_PRIVATE_KEY=$(cat secrets/azure-private)

# get urls
AZURE_PUBLIC_URL=https://mfoundation.blob.core.windows.net/litmon
AZURE_PRIVATE_URL=https://mfoundation.blob.core.windows.net/litmon-private

# download azcopy
if [ ! -f azure/azcopy ]; then
    cd azure
    wget -O azcopy_v10.tar.gz https://aka.ms/downloadazcopy-v10-linux &> /dev/null
    tar -xf azcopy_v10.tar.gz --strip-components=1 &> /dev/null
    rm NOTICE.txt
    rm azcopy_v10.tar.gz
    cd ..
fi
